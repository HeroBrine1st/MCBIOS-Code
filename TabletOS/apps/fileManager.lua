local a=require("filesystem")local b=require("component")local c=b.gpu;local d=require("ECSAPI")local e=require("term")local f=require("unicode")local g=require("zygote")local h=math;local i=require("shell")local j={}local k,l=c.getResolution()local m=require("TabletOSCore")local n=d.rememberOldPixels(1,1,80,25)c.setBackground(0x610B5E)c.setForeground(0xFFFFFF)c.set(1,1,m.getLanguagePackages().fileManager)local o=g.addForm()o.left=1;o.top=2;o.W=80;o.H=23;o.color=0xCCCCCC;local function p()o:setActive()end;local function q(r)g.stop(o)d.drawOldPixels(n)end;local s="/"local t;local u=o:addList(1,2,function(r)local v=r.items[r.index]if a.isDirectory(v)then oldPath=s;s=v;r:clear()r:insert("/","/")r:insert("..",oldPath)for w in a.list(s)do r:insert(w,s..w)end elseif a.exists(v)then t=d.rememberOldPixels(1,1,80,25)local x=g.addForm()x.left=30;x.top=12-2;x.W=20;x.H=5;windowButton1=x:addButton(1,1,"Edit",function()i.execute("edit "..v)d.drawOldPixels(t)p()end)windowButton2=x:addButton(1,2,"Execute",function()e.clear()local y,z=i.execute(v)if not y then d.error(z)end;d.drawOldPixels(t)p()end)windowButton3=x:addButton(1,3,"Remove",function()i.execute("rm "..v)d.drawOldPixels(t)p()end)local function A()g.stop(x)end;windowButton4=x:addButton(1,4,"To workTable",function()local B=io.open("/usr/table/"..a.name(v),"w")B:write("dofile(\""..v.."\")")B:close()d.drawOldPixels(t)p()end)windowButton5=x:addButton(1,5,"Exit",function()d.drawOldPixels(t)p()end)windowButton1.W=20;windowButton2.W=20;windowButton3.W=20;windowButton4.W=20;windowButton5.W=20;g.run(x)p()end end)u.W=80;u.H=22;u.color=0xCCCCCC;u.fontColor=0xFFFFFF-0xCCCCCC;u.border=0;local function C()local D=u;u:clear()u:insert("/","/")u:insert("..",D.items[2])for w in a.list(s)do u:insert(w,s..w)end;D=nil end;local E=o:addButton(1,1,m.getLanguagePackages().newFolder,function()t=d.rememberOldPixels(1,1,80,25)local x=g.addForm()x.left=30;x.top=25/2-2;x.W=20;x.H=4;local F=x:addEdit(1,1,function(r)local v=r.text;if v then local E=s..v;a.makeDirectory(E)d.drawOldPixels(t)p()C()end end)g.run(x)end)E.W=20;local G=o:addButton(21,1,m.getLanguagePackages().newFile,function()t=d.rememberOldPixels(1,1,80,25)local x=g.addForm()x.left=30;x.top=25/2-2;x.W=20;x.H=4;local F=x:addEdit(1,1,function(r)local v=r.text;if v then local G=s..v;local H=io.open(G,"w")if H then H:write("")H:close()end;d.drawOldPixels(t)p()C()end end)g.run(x)end)G.W=20;local I=o:addButton(41,1,m.getLanguagePackages().updateFileList,C)I.W=20;C()local j;local function J(K,K,L,M,N,K)if N==0 and(L==40 or L==35)and M==25 then local y,z=pcall(q)if not y then if z then d.error("Unable to exit program:"..z)end end end;local O=m.getLanguagePackages().power;local P=f.len(O)if d.clickedAtArea(76-P,1,76,1,L,M)then q()local Q=d.rememberOldPixels(1,1,80,25)d.clearScreen(0x000000)d.waitForTouchOrClick()d.drawOldPixels(Q)g.run(o)end;if N==0 and L==1 and M==25 then j=d.rememberOldPixels(1,2,80,24)drawMenu()d.drawOldPixels(j)end end;o:addEvent("touch",J)g.run(o)
